<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Event - LIT Timeline Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html, body { min-height: 100%; margin: 0; padding: 0; }
        body {
            font-family: 'Inter', sans-serif;
            /* Darker, less blue gradient */
            background-image: linear-gradient(to bottom right, #0a0e14, #000000, #0a0e14);
            background-attachment: fixed;
            color: #d1d5db; /* gray-300 */
        }
        .glass-card {
            /* Darker glass effect */
            background: rgba(17, 24, 39, 0.7); /* gray-900 with opacity */
            backdrop-filter: blur(16px) saturate(120%);
            -webkit-backdrop-filter: blur(16px) saturate(120%);
            border: 1px solid rgba(55, 65, 81, 0.5); /* gray-700 with opacity */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
        }
         input[type="text"], select, textarea {
             /* Darker inputs */
            background-color: rgba(31, 41, 55, 0.8) !important; /* gray-800 */
            border-color: rgba(75, 85, 99, 0.6) !important; /* gray-600 */
            color: #e5e7eb; /* gray-200 */
            border-radius: 0.375rem; /* rounded-md */
            transition: all 0.2s ease-in-out;
         }
         input[type="text"]:focus, select:focus, textarea:focus {
             /* Emerald focus */
            border-color: rgba(16, 185, 129, 0.8) !important; /* emerald-500 */
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.3);
            outline: none;
         }
         button { transition: all 0.2s ease-in-out; }
         button:hover:not(:disabled) {
            filter: brightness(1.15);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
         }
         /* Simple Scrollbar for tag lists */
         .tag-list::-webkit-scrollbar { width: 4px; }
         .tag-list::-webkit-scrollbar-track { background: transparent; }
         .tag-list::-webkit-scrollbar-thumb { background-color: rgba(75, 85, 99, 0.5); border-radius: 20px; }

    </style>
</head>
<body class="text-gray-200 p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <!-- Grid for side-by-side layout on medium+ screens -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

            <!-- Coluna 1: Formul√°rio Principal -->
            <div class="glass-card p-6 md:p-8">
                <!-- Emerald title gradient -->
                <h1 class="text-3xl font-bold mb-6 text-center text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-teal-400">Add New Timeline Event</h1>

                <form id="event-form" class="space-y-5">
                    <div>
                        <label for="tag-principal" class="block text-sm font-medium text-gray-300 mb-1">Main Tag *</label>
                        <select id="tag-principal" name="tag-principal" required class="w-full px-3 py-2 focus:outline-none" aria-label="Select Main Tag">
                            <!-- Options loaded by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="tag-secundaria" class="block text-sm font-medium text-gray-300 mb-1">Secondary Tag *</label>
                        <select id="tag-secundaria" name="tag-secundaria" required class="w-full px-3 py-2 focus:outline-none" aria-label="Select Secondary Tag">
                            <!-- Options loaded by JS -->
                        </select>
                    </div>
                    <div>
                        <label for="titulo" class="block text-sm font-medium text-gray-300 mb-1">Short Title *</label>
                        <input type="text" id="titulo" name="titulo" required maxlength="50" placeholder="E.g., Landing Page Deployed" class="w-full px-3 py-2 focus:outline-none" aria-label="Enter Short Title">
                    </div>
                    <div>
                        <label for="descricao" class="block text-sm font-medium text-gray-300 mb-1">Detailed Description * (Use \n for new lines)</label>
                        <textarea id="descricao" name="descricao" rows="4" required placeholder="Details of what was done... Use \\n for line breaks in JSON." class="w-full px-3 py-2 focus:outline-none" aria-label="Enter Detailed Description"></textarea>
                    </div>
                     <div>
                        <label for="icone" class="block text-sm font-medium text-gray-300 mb-1">Lucide Icon Name (Optional)</label>
                        <input type="text" id="icone" name="icone" placeholder="E.g., Code, Palette (Leave blank for default)" class="w-full px-3 py-2 focus:outline-none" aria-label="Enter Lucide Icon Name (Optional)">
                        <p class="text-xs text-gray-400 mt-1">Find names at: <a href="https://lucide.dev/icons/" target="_blank" class="text-emerald-400 hover:underline">lucide.dev/icons</a></p>
                     </div>
                    <!-- Emerald main button -->
                    <button type="submit" class="w-full bg-gradient-to-r from-emerald-600 to-teal-500 hover:from-emerald-700 hover:to-teal-600 text-white font-bold py-2.5 px-4 rounded-lg shadow-lg">
                        Generate JSON Entry & Commit Msg
                    </button>
                </form>

                <!-- Results Area -->
                <div id="results" class="mt-8 p-5 bg-black/40 backdrop-blur-sm border border-gray-600/50 rounded-lg hidden">
                    <h2 class="text-xl font-semibold mb-4 text-emerald-400 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>Success! Copy and paste below:</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="json-filename" class="block text-sm font-medium text-gray-300 mb-1">1. JSON Filename (in `public/data/` folder):</label>
                            <input type="text" id="json-filename" readonly class="w-full bg-gray-700/70 text-gray-300 px-3 py-1.5 rounded-md border border-gray-600/50 cursor-pointer focus:outline-none focus:ring-1 focus:ring-emerald-500" onclick="this.select()" aria-label="JSON Filename to use">
                        </div>
                        <div>
                            <label id="json-label" for="json-output" class="block text-sm font-medium text-gray-300 mb-1">2. JSON Block to add (Paste inside `[]`, BEFORE final `]`):</label>
                            <textarea id="json-output" rows="12" readonly class="w-full bg-gray-700/70 text-gray-300 px-3 py-2 rounded-md border border-gray-600/50 font-mono text-sm cursor-pointer focus:outline-none focus:ring-1 focus:ring-emerald-500" onclick="this.select()" aria-label="Generated JSON Block"></textarea>
                            <p class="text-xs text-yellow-400 mt-1">‚ö†Ô∏è **Important:** Always add a comma `,` before pasting this block if other entries already exist in the file. If this is the **very first entry** for the month, create the file and paste this block between `[` and `]`.</p>
                        </div>
                         <div>
                            <label for="commit-message" class="block text-sm font-medium text-gray-300 mb-1">3. Suggested Commit Message:</label>
                            <input type="text" id="commit-message" readonly class="w-full bg-gray-700/70 text-gray-300 px-3 py-1.5 rounded-md border border-gray-600/50 cursor-pointer focus:outline-none focus:ring-1 focus:ring-emerald-500" onclick="this.select()" aria-label="Suggested Git Commit Message">
                        </div>
                    </div>
                     <p class="text-xs text-gray-400 mt-4">üëâ Remember to `git add .`, `git commit -m "YOUR MESSAGE"`, and `git push` after pasting.</p>
                 </div>
            </div>

            <!-- Coluna 2: Tag Management -->
            <div class="glass-card p-6 md:p-8">
                <!-- Emerald accent -->
                <h2 class="text-2xl font-bold mb-6 text-center text-emerald-400">Manage Tags</h2>
                <div class="space-y-6"> <!-- Changed grid to space-y for better stacking on small screens -->
                    <!-- Main Tags -->
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-gray-300 border-b border-gray-600 pb-1">Main Tags</h3>
                        <ul id="main-tags-list" class="mb-4 space-y-2 max-h-48 overflow-y-auto pr-2 tag-list"></ul>
                        <div class="flex gap-2 items-center">
                            <!-- grow allows input to take space -->
                            <input type="text" id="new-main-tag" placeholder="New main tag (e.g., TEST)" class="grow px-3 py-1.5 rounded-md text-sm focus:outline-none" aria-label="Add new main tag">
                            <!-- shrink-0 prevents button shrinking -->
                            <button id="add-main-tag-btn" class="shrink-0 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-1.5 rounded-md text-sm shadow-md">Add</button>
                        </div>
                    </div>
                    <!-- Secondary Tags -->
                    <div>
                         <h3 class="text-lg font-semibold mb-3 text-gray-300 border-b border-gray-600 pb-1">Secondary Tags</h3>
                         <ul id="secondary-tags-list" class="mb-4 space-y-2 max-h-48 overflow-y-auto pr-2 tag-list"></ul>
                         <div class="flex gap-2 items-center">
                             <!-- grow allows input to take space -->
                            <input type="text" id="new-secondary-tag" placeholder="New secondary tag (e.g., WIP)" class="grow px-3 py-1.5 rounded-md text-sm focus:outline-none" aria-label="Add new secondary tag">
                             <!-- shrink-0 prevents button shrinking -->
                            <button id="add-secondary-tag-btn" class="shrink-0 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-1.5 rounded-md text-sm shadow-md">Add</button>
                         </div>
                    </div>
                </div>
            </div>

        </div> <!-- End Grid -->
    </div> <!-- End Max Width Container -->


    <!-- Footer -->
    <footer class="text-center text-xs text-gray-500 mt-12 pb-4">
        LIT Timeline Tool - Local Use Only | &copy; <span id="footer-year"></span>
    </footer>

    <script>
        // --- DOM Elements ---
        const form = document.getElementById('event-form');
        const resultsDiv = document.getElementById('results');
        const jsonFilenameInput = document.getElementById('json-filename');
        const jsonOutputTextarea = document.getElementById('json-output');
        const commitMessageInput = document.getElementById('commit-message');
        const jsonLabel = document.getElementById('json-label');
        const mainTagSelect = document.getElementById('tag-principal');
        const secondaryTagSelect = document.getElementById('tag-secundaria');
        const mainTagsList = document.getElementById('main-tags-list');
        const secondaryTagsList = document.getElementById('secondary-tags-list');
        const newMainTagInput = document.getElementById('new-main-tag');
        const addMainTagBtn = document.getElementById('add-main-tag-btn');
        const newSecondaryTagInput = document.getElementById('new-secondary-tag');
        const addSecondaryTagBtn = document.getElementById('add-secondary-tag-btn');
        const footerYearSpan = document.getElementById('footer-year'); // Get footer year span

        // --- Tag Management ---
        let mainTags = [];
        let secondaryTags = [];
        const defaultMainTags = ['DEV', 'DESIGN', 'DOCS', 'COMMUNITY', 'MARKETING', 'META'];
        const defaultSecondaryTags = ['NEW', 'UPDATE', 'FIX', 'REFACTOR', 'RELEASE', 'POST', 'INIT', 'WIP'];
        const MAIN_TAGS_KEY = 'timelineMainTags_v4';
        const SECONDARY_TAGS_KEY = 'timelineSecondaryTags_v4';

        function saveTags() {
            try {
                localStorage.setItem(MAIN_TAGS_KEY, JSON.stringify(mainTags));
                localStorage.setItem(SECONDARY_TAGS_KEY, JSON.stringify(secondaryTags));
            } catch (e) { console.error("Error saving tags:", e); }
        }

        function loadTags() {
            try {
                const storedMain = localStorage.getItem(MAIN_TAGS_KEY);
                const storedSecondary = localStorage.getItem(SECONDARY_TAGS_KEY);
                mainTags = storedMain ? JSON.parse(storedMain) : [...defaultMainTags];
                secondaryTags = storedSecondary ? JSON.parse(storedSecondary) : [...defaultSecondaryTags];
            } catch (e) {
                console.error("Error loading tags, resetting to defaults:", e);
                mainTags = [...defaultMainTags];
                secondaryTags = [...defaultSecondaryTags];
            }
            if (!Array.isArray(mainTags) || mainTags.length === 0) mainTags = [...defaultMainTags];
            if (!Array.isArray(secondaryTags) || secondaryTags.length === 0) secondaryTags = [...defaultSecondaryTags];
            mainTags.sort();
            secondaryTags.sort();
            populateSelects();
            renderTagLists();
        }

        function populateSelects() {
            mainTagSelect.innerHTML = mainTags.map(tag => `<option value="${tag}">${tag}</option>`).join('');
            secondaryTagSelect.innerHTML = secondaryTags.map(tag => `<option value="${tag}">${tag}</option>`).join('');
        }

        function renderTagLists() {
            const createListItem = (tag, index, type) => `
                <li class="flex justify-between items-center text-sm bg-gray-700/50 px-3 py-1 rounded-md border border-gray-600/50 shadow-sm">
                    <span class="font-medium text-gray-300">${tag}</span>
                    <button data-index="${index}" data-type="${type}" class="text-red-400 hover:text-red-500 ml-3 font-bold text-lg leading-none focus:outline-none focus:ring-1 focus:ring-red-500 focus:ring-opacity-50 rounded-full p-0.5" title="Remove tag">&times;</button>
                </li>`;
            mainTagsList.innerHTML = mainTags.map((tag, index) => createListItem(tag, index, 'main')).join('');
            secondaryTagsList.innerHTML = secondaryTags.map((tag, index) => createListItem(tag, index, 'secondary')).join('');
            document.querySelectorAll('#main-tags-list button, #secondary-tags-list button').forEach(button => {
                button.removeEventListener('click', handleRemoveTag);
                button.addEventListener('click', handleRemoveTag);
            });
        }

        function handleAddTag(type) {
            const input = (type === 'main') ? newMainTagInput : newSecondaryTagInput;
            const tagList = (type === 'main') ? mainTags : secondaryTags;
            const newTag = input.value.trim().toUpperCase().replace(/[^A-Z0-9_\-]/g, '');

            if (newTag && newTag.length > 0 && newTag.length <= 15) {
                 if (!tagList.includes(newTag)) {
                    tagList.push(newTag);
                    tagList.sort();
                    saveTags();
                    populateSelects();
                    renderTagLists();
                    input.value = '';
                 } else { alert(`Tag "${newTag}" already exists.`); }
            } else if (!newTag) { alert('Tag cannot be empty.'); }
            else { alert('Tag is too long (max 15 chars) or contains invalid characters (only A-Z, 0-9, _, - allowed).'); }
             input.focus();
        }

        function handleRemoveTag(event) {
            const button = event.target;
            const index = parseInt(button.dataset.index);
            const type = button.dataset.type;
            const tagList = (type === 'main') ? mainTags : secondaryTags;
            const tagName = tagList[index];

            if (tagList.length <= 1) {
                alert(`Cannot remove the last ${type} tag.`);
                return;
            }

            if (confirm(`Are you sure you want to remove the tag "${tagName}"?`)) {
                tagList.splice(index, 1);
                saveTags();
                populateSelects();
                renderTagLists();
            }
        }

        // --- Event Listeners ---
        addMainTagBtn.addEventListener('click', (e) => { e.preventDefault(); handleAddTag('main'); });
        newMainTagInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); handleAddTag('main'); } });
        addSecondaryTagBtn.addEventListener('click', (e) => { e.preventDefault(); handleAddTag('secondary'); });
        newSecondaryTagInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); handleAddTag('secondary'); } });

        // --- JSON Generation ---
        const defaultIcons = {
             DEV: 'Code2', DESIGN: 'Palette', DOCS: 'BookOpenText', COMMUNITY: 'Users2', MARKETING: 'Megaphone', META: 'Settings2',
             NEW: 'Sparkles', UPDATE: 'RotateCw', FIX: 'Wrench', REFACTOR: 'Lightbulb', RELEASE: 'Rocket', POST: 'MessageSquareText', INIT: 'PartyPopper', WIP: 'Construction',
             default: 'Milestone'
        };

        form.addEventListener('submit', (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hour = String(now.getHours()).padStart(2, '0');
            const minute = String(now.getMinutes()).padStart(2, '0');
            const second = String(now.getSeconds()).padStart(2, '0');

            const filename = `timeline-${year}-${month}.json`;
            const tagPrincipal = formData.get('tag-principal');
            const tagSecundaria = formData.get('tag-secundaria');
            const entryId = `${tagPrincipal}-${tagSecundaria}-${year}${month}${day}-${hour}${minute}${second}`;
            const titulo = formData.get('titulo');
            const descricao = formData.get('descricao').replace(/\r\n|\r|\n/g, '\\n');
            let iconeInput = formData.get('icone').trim();
            let icone = defaultIcons.default;

            if (iconeInput && /^[A-Z][A-Za-z0-9]*$/.test(iconeInput)) {
                icone = iconeInput;
            } else {
                if(iconeInput) console.warn(`Invalid or empty icon name '${iconeInput}', using default based on tags.`);
                icone = defaultIcons[tagPrincipal.toUpperCase()] || defaultIcons[tagSecundaria.toUpperCase()] || defaultIcons.default;
            }

            const newEntry = {
                id: entryId, date: now.toISOString(), tags: [tagPrincipal, tagSecundaria].filter(Boolean),
                icon: icone, title: titulo, description: descricao
            };

            const jsonString = JSON.stringify(newEntry, null, 2); // Pretty print JSON

            // Always generate with preceding comma and newline, assuming appending
            const outputString = `,\n${jsonString}`;
            // Corrected commit message - removed prefix
            const commitMsg = `Add ${tagPrincipal}/${tagSecundaria} - ${titulo}`;

            jsonFilenameInput.value = filename;
            jsonOutputTextarea.value = outputString;
            // Updated label text to reflect the always-append logic
            jsonLabel.textContent = `2. JSON Block to add to ${filename} (Paste inside [], BEFORE final \`]\`, add comma before if needed):`;

            commitMessageInput.value = commitMsg;
            resultsDiv.classList.remove('hidden');
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Clear only specific fields after generation
            document.getElementById('titulo').value = '';
            document.getElementById('descricao').value = '';
            document.getElementById('icone').value = '';
            document.getElementById('titulo').focus();
        });

        // --- Initial Load ---
        function initializeApp() {
             loadTags();
             // Set footer year
             if(footerYearSpan) {
                footerYearSpan.textContent = new Date().getFullYear();
             }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>
</html>

